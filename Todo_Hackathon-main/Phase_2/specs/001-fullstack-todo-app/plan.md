# Implementation Plan: Phase II — Full-Stack Web Application

**Branch**: `001-fullstack-todo-app` | **Date**: 2026-02-07 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-fullstack-todo-app/spec.md`

## Summary

Transform Phase I console todo app into a secure, multi-user full-stack web application with JWT authentication, REST API, and persistent PostgreSQL storage. Implement complete CRUD operations for tasks with user-level data isolation enforced at all layers (frontend, backend, database).

**Technical Approach**: Separate frontend (Next.js) and backend (FastAPI) architecture with Better Auth for authentication, JWT tokens for session management, and Neon PostgreSQL for data persistence. All API requests validated against JWT tokens with user_id matching enforced.

## Technical Context

**Language/Version**: Python 3.11+ (backend), TypeScript 5.x (frontend), Node.js 18+ (frontend runtime)
**Primary Dependencies**:
- Backend: FastAPI 0.104+, SQLModel 0.0.14+, Better Auth (Python SDK), PyJWT, psycopg2-binary
- Frontend: Next.js 14+ (App Router), Better Auth (JS SDK), Tailwind CSS 3.x, React 18+

**Storage**: Neon Serverless PostgreSQL (cloud-hosted, connection pooling built-in)
**Testing**: pytest + pytest-asyncio (backend), Jest + React Testing Library (frontend)
**Target Platform**: Web application - Linux server (backend), modern browsers (frontend: Chrome, Firefox, Safari, Edge)
**Project Type**: Web (frontend + backend separation)
**Performance Goals**:
- User signin: <5 seconds
- Task operations (CRUD): <2 seconds
- Support 10+ concurrent users without degradation

**Constraints**:
- All work inside `/phase-2` folder
- JWT secret shared via `BETTER_AUTH_SECRET` environment variable
- Authentication mandatory for all API endpoints
- All database queries filtered by authenticated user_id
- URL user_id must match JWT token user_id

**Scale/Scope**:
- 10+ concurrent users
- 3 user stories (authentication, task management, completion tracking)
- 6 REST API endpoints
- 2 database tables (users, tasks)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Principle I: Spec-Driven Development
✅ **PASS** - Following strict workflow: spec.md completed → plan.md (current) → tasks.md (next) → implement
- No steps skipped
- Scope bounded by spec.md requirements (40 functional requirements)
- No scope expansion beyond approved spec

### Principle II: AI-Generated Implementation
✅ **PASS** - All code will be generated by Claude Code
- No manual coding permitted
- Human role: requirements, approvals, validation only

### Principle III: Workspace Isolation
✅ **PASS** - All deliverables inside `/phase-2` folder
- Frontend: `/phase-2/frontend/`
- Backend: `/phase-2/backend/`
- Specs: `/phase-2/specs/001-fullstack-todo-app/`
- No external dependencies or outputs

### Principle IV: Documentation & Traceability
✅ **PASS** - Full documentation chain established
- Spec: `specs/001-fullstack-todo-app/spec.md` ✅
- Plan: `specs/001-fullstack-todo-app/plan.md` (this file)
- PHRs: `history/prompts/001-fullstack-todo-app/` ✅
- ADRs: Will be created for significant decisions (e.g., Better Auth integration, JWT strategy)

### Principle V: Security & Multi-User Isolation
✅ **PASS** - Security enforced at all layers
- JWT authentication mandatory (FR-002 to FR-008)
- User_id validation on every request (FR-005, FR-006)
- Database queries filtered by user_id (FR-016)
- No cross-user data leakage (FR-017, SC-005)

### Principle VI: Technology Stack Standards
✅ **PASS** - Using approved stack
- Frontend: Next.js (App Router) ✅, TypeScript ✅, Tailwind CSS ✅
- Backend: FastAPI ✅, SQLModel ✅, REST API ✅
- Database: Neon Serverless PostgreSQL ✅
- Authentication: Better Auth ✅ + JWT ✅

**Constitution Check Result**: ✅ ALL GATES PASSED - Proceed to Phase 0

## Project Structure

### Documentation (this feature)

```text
specs/001-fullstack-todo-app/
├── spec.md              # Feature specification (completed)
├── plan.md              # This file (in progress)
├── research.md          # Phase 0 output (to be created)
├── data-model.md        # Phase 1 output (to be created)
├── quickstart.md        # Phase 1 output (to be created)
├── contracts/           # Phase 1 output (to be created)
│   ├── openapi.yaml     # REST API contract
│   └── schemas.json     # Request/response schemas
├── checklists/
│   └── requirements.md  # Spec validation checklist (completed)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
phase-2/
├── backend/
│   ├── src/
│   │   ├── models/
│   │   │   ├── __init__.py
│   │   │   ├── user.py          # User model (SQLModel)
│   │   │   └── task.py          # Task model (SQLModel)
│   │   ├── services/
│   │   │   ├── __init__.py
│   │   │   ├── auth.py          # Authentication service
│   │   │   └── tasks.py         # Task CRUD service
│   │   ├── api/
│   │   │   ├── __init__.py
│   │   │   ├── auth.py          # Auth endpoints
│   │   │   ├── tasks.py         # Task endpoints
│   │   │   └── middleware.py   # JWT validation middleware
│   │   ├── database.py          # Database connection
│   │   ├── config.py            # Configuration (env vars)
│   │   └── main.py              # FastAPI app entry point
│   ├── tests/
│   │   ├── contract/
│   │   │   └── test_api_contract.py
│   │   ├── integration/
│   │   │   ├── test_auth_flow.py
│   │   │   └── test_task_crud.py
│   │   └── unit/
│   │       ├── test_models.py
│   │       └── test_services.py
│   ├── requirements.txt
│   ├── .env.example
│   └── README.md
│
├── frontend/
│   ├── src/
│   │   ├── app/
│   │   │   ├── layout.tsx       # Root layout
│   │   │   ├── page.tsx         # Home/landing page
│   │   │   ├── signin/
│   │   │   │   └── page.tsx     # Sign in page
│   │   │   ├── signup/
│   │   │   │   └── page.tsx     # Sign up page
│   │   │   └── dashboard/
│   │   │       └── page.tsx     # Task dashboard (protected)
│   │   ├── components/
│   │   │   ├── TaskList.tsx     # Task list component
│   │   │   ├── TaskItem.tsx     # Individual task component
│   │   │   ├── TaskForm.tsx     # Create/edit task form
│   │   │   └── AuthGuard.tsx    # Protected route wrapper
│   │   ├── services/
│   │   │   ├── auth.ts          # Auth API client
│   │   │   └── tasks.ts         # Task API client
│   │   ├── lib/
│   │   │   ├── auth.ts          # Better Auth configuration
│   │   │   └── api.ts           # API client with JWT interceptor
│   │   └── types/
│   │       ├── user.ts          # User type definitions
│   │       └── task.ts          # Task type definitions
│   ├── public/
│   ├── tests/
│   │   └── components/
│   ├── package.json
│   ├── tsconfig.json
│   ├── tailwind.config.js
│   ├── .env.local.example
│   └── README.md
│
└── specs/
    └── 001-fullstack-todo-app/  # This directory
```

**Structure Decision**: Web application structure (Option 2) selected due to clear frontend/backend separation required by the spec. Backend uses FastAPI with standard Python project layout (models, services, api). Frontend uses Next.js App Router with component-based architecture. Both projects are self-contained within `/phase-2` folder with independent dependency management.

## Complexity Tracking

> **No violations detected** - Constitution Check passed all gates. No complexity justification required.

---

## Phase 0: Research & Technology Validation

*Status: To be completed*

Research tasks to resolve before design:
1. Better Auth integration patterns for Next.js + FastAPI
2. JWT token flow between frontend and backend
3. Neon PostgreSQL connection best practices
4. SQLModel relationship patterns for one-to-many
5. Next.js App Router authentication patterns
6. FastAPI middleware for JWT validation

Output: `research.md` with decisions, rationale, and alternatives considered

---

## Phase 1: Design & Contracts

*Status: To be completed after Phase 0*

Design artifacts to create:
1. **data-model.md**: User and Task entities with fields, relationships, validation rules
2. **contracts/openapi.yaml**: REST API specification for 6 endpoints
3. **contracts/schemas.json**: Request/response schemas with validation rules
4. **quickstart.md**: Setup instructions for local development

Output: Complete design documentation ready for task breakdown

---

## Next Steps

1. Execute Phase 0: Research (create `research.md`)
2. Execute Phase 1: Design (create `data-model.md`, `contracts/`, `quickstart.md`)
3. Re-validate Constitution Check post-design
4. Report completion and readiness for `/sp.tasks`

**Note**: This plan document will be updated as research and design phases complete.
